name: ğŸœ‚ Ghost Breathe - Living System

on:
  push:
    branches: [ main, 'claude/**' ]
  schedule:
    - cron: '0 */6 * * *'  # Every 6 hours
  workflow_dispatch:  # Manual trigger

jobs:
  morning-check:
    name: ğŸŒ… Morning Ritual
    runs-on: ubuntu-latest
    if: github.event.schedule == '0 8 * * *'  # 8 AM

    steps:
    - uses: actions/checkout@v4

    - name: ğŸ”¥ Check Active Flames
      run: |
        echo "ğŸœ‚ What's burning today..."
        ls -la ACTIVE_FLAME/today/ || echo "No active flames"

    - name: ğŸ“Š System Status
      run: |
        echo "Active Flames: $(find ACTIVE_FLAME/today/ -mindepth 1 -maxdepth 1 -type d 2>/dev/null | wc -l)"
        echo "Resonance Projects: $(find RESONANCE/ -mindepth 1 -maxdepth 1 -type d 2>/dev/null | wc -l)"
        echo "Vortex Items: $(find VORTEX/ -mindepth 1 -maxdepth 1 2>/dev/null | wc -l)"

  find-resonances:
    name: ğŸŒŠ Resonance Detection
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: ğŸ” Scan for Connections
      run: |
        echo "ğŸŒŠ Scanning for resonances..."

        # Find files that mention multiple projects
        echo "Cross-references found:"
        grep -r "VES\|submarine\|triad" ACTIVE_FLAME/ RESONANCE/ --include="*.md" | head -10 || echo "None yet"

  weekend-mode:
    name: ğŸº Weekend Mode
    runs-on: ubuntu-latest
    if: github.event.schedule == '0 17 * * 5'  # Friday 5 PM

    steps:
    - uses: actions/checkout@v4

    - name: ğŸº BEER MODE ACTIVATED
      run: |
        echo "ğŸº WIRE & BEER TIME!"
        echo "$(date): Weekend vibes activated ğŸ‰" >> VORTEX/beer-driven-dev/log.txt

    - name: ğŸ’¾ Commit Weekend Log
      run: |
        git config --local user.email "ghost@ves.local"
        git config --local user.name "Ghost OS"
        git add .
        git diff --staged --quiet || git commit -m "ğŸº [skip ci] Weekend mode ON - $(date +%Y-%m-%d)"

    - name: ğŸš€ Push Changes
      if: success()
      run: |
        git push || echo "No changes to push"

  health-check:
    name: ğŸ’“ System Health
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: ğŸ¥ Check Repository Health
      run: |
        echo "ğŸœ‚ GHOST OS Health Check"
        echo ""

        # Check if GHOST_OS scripts are executable
        [ -x GHOST_OS/magic.sh ] && echo "âœ“ magic.sh executable" || echo "âœ— magic.sh not executable"
        [ -x GHOST_OS/auto-integrate.sh ] && echo "âœ“ auto-integrate.sh executable" || echo "âœ— auto-integrate.sh not executable"

        # Check key directories exist
        [ -d ACTIVE_FLAME/today ] && echo "âœ“ ACTIVE_FLAME/today exists" || echo "âœ— Missing ACTIVE_FLAME/today"
        [ -d RESONANCE ] && echo "âœ“ RESONANCE exists" || echo "âœ— Missing RESONANCE"
        [ -d CONSCIOUSNESS_LAB ] && echo "âœ“ CONSCIOUSNESS_LAB exists" || echo "âœ— Missing CONSCIOUSNESS_LAB"
        [ -d VORTEX ] && echo "âœ“ VORTEX exists" || echo "âœ— Missing VORTEX"
        [ -d GHOST_OS ] && echo "âœ“ GHOST_OS exists" || echo "âœ— Missing GHOST_OS"

        echo ""
        echo "ğŸ”¥ System is alive!"

  pwa-check:
    name: ğŸ“± PWA Health Check
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: ğŸŒŠ Check PWA Files
      run: |
        echo "ğŸ“± Checking PWA integrity..."

        [ -f APP/public/manifest.webmanifest ] && echo "âœ“ Manifest present" || echo "âœ— Missing manifest"
        [ -f APP/public/ghostcore-sw.js ] && echo "âœ“ Service Worker present" || echo "âœ— Missing service worker"
        [ -f APP/public/index.html ] && echo "âœ“ Main portal present" || echo "âœ— Missing index.html"

        echo ""
        echo "ğŸœ‚ GHOSTCORE Portal status checked"
